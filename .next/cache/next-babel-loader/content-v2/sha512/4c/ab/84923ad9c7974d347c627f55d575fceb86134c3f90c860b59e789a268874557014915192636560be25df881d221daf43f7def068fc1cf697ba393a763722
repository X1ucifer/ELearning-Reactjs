{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React from 'react';\nimport { parseCookies } from 'nookies';\nimport axios from 'axios';\nimport { Spinner } from 'reactstrap';\nimport toast from 'react-hot-toast';\nimport { useRouter } from 'next/router';\nimport baseUrl from '@/utils/baseUrl';\nimport catchErrors from '@/utils/catchErrors';\nimport PageBanner from '@/components/Common/PageBanner';\nimport Link from '@/utils/ActiveLink';\nconst INIT_COURSE = {\n  title: '',\n  overview: '',\n  price: 0.00,\n  profilePhoto: '',\n  published: true,\n  coverPhoto: '',\n  course_preview_img: '',\n  course_preview_video: '',\n  duration: '',\n  lessons: '',\n  category: ''\n};\n\nconst Create = () => {\n  const {\n    token\n  } = parseCookies();\n  const router = useRouter();\n  const [course, setCourse] = React.useState(INIT_COURSE);\n  const [profilePreview, setProfilePreview] = React.useState('');\n  const [coverPhotoPreview, setCoverPhotoPreview] = React.useState('');\n  const [coursePreviewImg, setCoursePreviewImg] = React.useState('');\n  const [imageUploading, setImageUploading] = React.useState(false);\n  const [loading, setLoading] = React.useState(false);\n  const [disabled, setDisabled] = React.useState(true);\n  const [error, setError] = React.useState();\n  React.useEffect(() => {\n    const isCourse = Object.values(course).every(el => Boolean(el));\n    isCourse ? setDisabled(false) : setDisabled(true);\n  }, [course]);\n\n  const handleChange = e => {\n    // console.log(d.value)\n    const {\n      name,\n      value,\n      files\n    } = e.target;\n\n    if (name === 'profilePhoto') {\n      const profilePhotoSize = files[0].size / 1024 / 1024;\n\n      if (profilePhotoSize > 2) {\n        addToast('The profile photo size greater than 2 MB. Make sure less than 2 MB.', {\n          appearance: 'error'\n        });\n        e.target.value = null;\n        return;\n      }\n\n      setCourse(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        profilePhoto: files[0]\n      }));\n      setProfilePreview(window.URL.createObjectURL(files[0]));\n    } else if (name === 'coverPhoto') {\n      const coverPhotoSize = files[0].size / 1024 / 1024;\n\n      if (coverPhotoSize > 2) {\n        addToast('The cover photo size greater than 2 MB. Make sure less than 2 MB.', {\n          appearance: 'error'\n        });\n        e.target.value = null;\n        return;\n      }\n\n      setCourse(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        coverPhoto: files[0]\n      }));\n      setCoverPhotoPreview(window.URL.createObjectURL(files[0]));\n    } else if (name === 'course_preview_img') {\n      const course_preview_img = files[0].size / 1024 / 1024;\n\n      if (course_preview_img > 2) {\n        addToast('The course preview omage size greater than 2 MB. Make sure less than 2 MB.', {\n          appearance: 'error'\n        });\n        e.target.value = null;\n        return;\n      }\n\n      setCourse(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        course_preview_img: files[0]\n      }));\n      setCoursePreviewImg(window.URL.createObjectURL(files[0]));\n    } else {\n      setCourse(prevState => _objectSpread(_objectSpread({}, prevState), {}, {\n        [name]: value\n      }));\n    } // console.log(course);\n\n  };\n\n  const handleProfilePhotoUpload = async () => {\n    setImageUploading(true); // console.log(post.file_url)\n\n    const data = new FormData();\n    data.append('file', course.profilePhoto);\n    data.append('upload_preset', 'vikings');\n    data.append('cloud_name', 'dev-empty');\n    let response;\n\n    if (course.profilePhoto) {\n      response = await axios.post(process.env.CLOUDINARY_URL, data);\n    }\n\n    const profilePhotoUrl = response.data.url;\n    return profilePhotoUrl;\n  };\n\n  const handlecoverPhotoUpload = async () => {\n    setImageUploading(true); // console.log(post.file_url)\n\n    const data = new FormData();\n    data.append('file', course.coverPhoto);\n    data.append('upload_preset', 'vikings');\n    data.append('cloud_name', 'dev-empty');\n    let response;\n\n    if (course.coverPhoto) {\n      response = await axios.post(process.env.CLOUDINARY_URL, data);\n    }\n\n    const cover_photo_url = response.data.url;\n    return cover_photo_url;\n  };\n\n  const handlePreviewPhotoUpload = async () => {\n    setImageUploading(true); // console.log(post.file_url)\n\n    const data = new FormData();\n    data.append('file', course.course_preview_img);\n    data.append('upload_preset', 'vikings');\n    data.append('cloud_name', 'dev-empty');\n    let response;\n\n    if (course.course_preview_img) {\n      response = await axios.post(process.env.CLOUDINARY_URL, data);\n    }\n\n    const preview_photo_response_url = response.data.url;\n    setImageUploading(false);\n    setLoading(true);\n    return preview_photo_response_url;\n  };\n\n  const handleCourseSubmit = async e => {\n    e.preventDefault();\n\n    try {\n      let profile = '';\n      let cover = '';\n      let preview = '';\n\n      if (course.profilePhoto && course.coverPhoto && course.course_preview_img) {\n        profile = await handleProfilePhotoUpload();\n        cover = await handlecoverPhotoUpload();\n        preview = await handlePreviewPhotoUpload();\n        profile = profile.replace(/^http:\\/\\//i, 'https://');\n        cover = cover.replace(/^http:\\/\\//i, 'https://');\n        preview = preview.replace(/^http:\\/\\//i, 'https://');\n      }\n\n      const url = `${baseUrl}/api/v1/courses/course/new`;\n      const {\n        title,\n        overview,\n        price,\n        published,\n        duration,\n        lessons,\n        category,\n        course_preview_video\n      } = course;\n      const payload = {\n        title,\n        overview,\n        price,\n        published,\n        duration,\n        lessons,\n        category,\n        profile,\n        cover,\n        preview,\n        course_preview_video\n      };\n      const response = await axios.post(url, payload, {\n        headers: {\n          Authorization: token\n        }\n      }); // console.log(response.data)\n\n      setLoading(false);\n      setCourse(INIT_COURSE);\n      setProfilePreview('');\n      setCoverPhotoPreview('');\n      setCoursePreviewImg('');\n      toast.success(response.data);\n      router.replace('/teacher/course/upload-course-video');\n    } catch (err) {\n      catchErrors(err, setError);\n      toast.error(error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return /*#__PURE__*/_jsxs(React.Fragment, {\n    children: [/*#__PURE__*/_jsx(PageBanner, {\n      pageTitle: \"Teacher Course Create\",\n      homePageUrl: \"/\",\n      homePageText: \"Home\",\n      activePageText: \"Teacher Course Create\"\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"ptb-100\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"container\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-md-4 col-lg-4\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"td-sidebar\",\n              children: /*#__PURE__*/_jsxs(\"ul\", {\n                children: [/*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/courses\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"My Courses\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/course/create\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Create A Course\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/courses/course-edit\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Edit My Course\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/course/upload-course-video\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Upload Course Video\"\n                    })\n                  })\n                })]\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-md-8 col-lg-8\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"border-box\",\n              children: [imageUploading && /*#__PURE__*/_jsx(\"h3\", {\n                className: \"loading-spinner\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"d-table\",\n                  children: /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"d-table-cell\",\n                    children: [/*#__PURE__*/_jsx(Spinner, {\n                      color: \"primary\"\n                    }), \" Image Uploading....\"]\n                  })\n                })\n              }), loading && /*#__PURE__*/_jsx(\"h3\", {\n                className: \"loading-spinner\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \"d-table\",\n                  children: /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"d-table-cell\",\n                    children: [/*#__PURE__*/_jsx(Spinner, {\n                      color: \"success\"\n                    }), \" Wait....\"]\n                  })\n                })\n              }), /*#__PURE__*/_jsxs(\"form\", {\n                onSubmit: handleCourseSubmit,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Title\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"Enter course title\",\n                    className: \"form-control\",\n                    name: \"title\",\n                    value: course.title,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Overview\"\n                  }), /*#__PURE__*/_jsx(\"textarea\", {\n                    type: \"text\",\n                    placeholder: \"Enter course overview\",\n                    className: \"form-control\",\n                    name: \"overview\",\n                    rows: \"10\",\n                    value: course.overview,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Price\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"number\",\n                    placeholder: \"Enter course price\",\n                    className: \"form-control\",\n                    name: \"price\",\n                    value: course.price,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Lessons\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"30 Lessons\",\n                    className: \"form-control\",\n                    name: \"lessons\",\n                    value: course.lessons,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Duration (Whole numbers of hours & minutes)\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"10 hours 30 minutes\",\n                    className: \"form-control\",\n                    name: \"duration\",\n                    value: course.duration,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Categories\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"React, Ruby, Rails\",\n                    className: \"form-control\",\n                    name: \"category\",\n                    value: course.category,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Course Profile (\", /*#__PURE__*/_jsx(\"i\", {\n                      children: \"Image less than 2 MB & size 750x500\"\n                    }), \")\"]\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"file\",\n                    name: \"profilePhoto\",\n                    accept: \"image/*\",\n                    onChange: handleChange\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"img\", {\n                    src: profilePreview,\n                    className: \"mxw-200 mt-20\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Course Cover Photo (\", /*#__PURE__*/_jsx(\"i\", {\n                      children: \"Image less than 2 MB & size 1920x500\"\n                    }), \")\"]\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"file\",\n                    name: \"coverPhoto\",\n                    accept: \"image/*\",\n                    onChange: handleChange\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"img\", {\n                    src: coverPhotoPreview,\n                    className: \"mxw-200 mt-20\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Course Preview Video URL\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"https://www.youtube.com/watch?v=Ke90Tje7VS0\",\n                    className: \"form-control\",\n                    name: \"course_preview_video\",\n                    value: course.course_preview_video,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsxs(\"label\", {\n                    children: [\"Course Preview Image (\", /*#__PURE__*/_jsx(\"i\", {\n                      children: \"Image less than 2 MB & size 750x500\"\n                    }), \")\"]\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"file\",\n                    name: \"course_preview_img\",\n                    accept: \"image/*\",\n                    onChange: handleChange\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"img\", {\n                    src: coursePreviewImg,\n                    className: \"mxw-200 mt-20\"\n                  })]\n                }), /*#__PURE__*/_jsxs(\"button\", {\n                  className: \"default-btn\",\n                  disabled: imageUploading || disabled || loading,\n                  type: \"submit\",\n                  children: [/*#__PURE__*/_jsx(\"i\", {\n                    className: \"flaticon-right-chevron\"\n                  }), \"Create\", imageUploading || loading ? /*#__PURE__*/_jsx(Spinner, {\n                    color: \"success\"\n                  }) : '', /*#__PURE__*/_jsx(\"span\", {})]\n                })]\n              })]\n            })\n          })]\n        })\n      })\n    })]\n  });\n};\n\nexport default Create;","map":null,"metadata":{},"sourceType":"module"}