{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"C:/Users/AJ/Downloads/Spyberrys/Spyberrys/Spyberrys_app/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"C:/Users/AJ/Downloads/Spyberrys/Spyberrys/Spyberrys_app/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/AJ/Downloads/Spyberrys/Spyberrys/Spyberrys_app/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/AJ/Downloads/Spyberrys/Spyberrys/Spyberrys_app/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { parseCookies } from 'nookies';\nimport axios from 'axios';\nimport { Alert } from 'reactstrap';\nimport baseUrl from '@/utils/baseUrl';\nimport { Spinner } from 'reactstrap';\nimport toast from 'react-hot-toast';\nimport catchErrors from '@/utils/catchErrors';\nimport PageBanner from '@/components/Common/PageBanner';\nimport Link from '@/utils/ActiveLink';\nvar INIT_VIDEO = {\n  video_url: '',\n  order: 0,\n  name: '',\n  description: '',\n  courseId: ''\n};\n\nvar UploadCourseVideo = function UploadCourseVideo(_ref) {\n  var courses = _ref.courses;\n\n  // console.log(courses)\n  var _parseCookies = parseCookies(),\n      token = _parseCookies.token;\n\n  var _React$useState = React.useState(INIT_VIDEO),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      video = _React$useState2[0],\n      setVideo = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      loading = _React$useState4[0],\n      setLoading = _React$useState4[1];\n\n  var _React$useState5 = React.useState(true),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      disabled = _React$useState6[0],\n      setDisabled = _React$useState6[1];\n\n  React.useEffect(function () {\n    var order = video.order,\n        video_url = video.video_url,\n        name = video.name;\n    var isVideo = Object.values({\n      video_url: video_url,\n      name: name,\n      order: order\n    }).every(function (el) {\n      return Boolean(el);\n    });\n    isVideo ? setDisabled(false) : setDisabled(true);\n  }, [video]);\n\n  var handleVideoUpload = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var data, response, mediaUrl;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              // console.log(post.file_url)\n              data = new FormData();\n              data.append('file', video.video_url);\n              data.append('upload_preset', '');\n              data.append('cloud_name', '');\n              _context.next = 6;\n              return axios.post(process.env.CLOUDINARY_VIDEO_URL, data);\n\n            case 6:\n              response = _context.sent;\n              mediaUrl = response.data.url;\n              return _context.abrupt(\"return\", mediaUrl);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleVideoUpload() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleChange = function handleChange(e) {\n    // console.log(d.value)\n    var _e$target = e.target,\n        name = _e$target.name,\n        value = _e$target.value,\n        files = _e$target.files;\n\n    if (name === 'video_url') {\n      var videoSize = files[0].size / 1024 / 1024;\n\n      if (videoSize > 20) {\n        addToast('The video size greater than 20 MB. Make sure less than 20 MB.', {\n          appearance: 'error'\n        });\n        e.target.value = null;\n        return;\n      }\n\n      setVideo(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, {\n          video_url: files[0]\n        });\n      });\n    } else {\n      setVideo(function (prevState) {\n        return _objectSpread(_objectSpread({}, prevState), {}, _defineProperty({}, name, value));\n      });\n    } // console.log(video);\n\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e) {\n      var videoUrl, videoUpload, url, order, name, description, courseId, payload, response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              e.preventDefault();\n              setLoading(true);\n              _context2.prev = 2;\n              videoUrl = '';\n\n              if (!video.video_url) {\n                _context2.next = 9;\n                break;\n              }\n\n              _context2.next = 7;\n              return handleVideoUpload();\n\n            case 7:\n              videoUpload = _context2.sent;\n              videoUrl = videoUpload.replace(/^http:\\/\\//i, 'https://');\n\n            case 9:\n              // console.log(videoUrl)\n              url = \"\".concat(baseUrl, \"/api/v1/courses/course/video-upload\");\n              order = video.order, name = video.name, description = video.description, courseId = video.courseId;\n              payload = {\n                order: order,\n                name: name,\n                description: description,\n                courseId: courseId,\n                videoUrl: videoUrl\n              };\n              _context2.next = 14;\n              return axios.post(url, payload, {\n                headers: {\n                  Authorization: token\n                }\n              });\n\n            case 14:\n              response = _context2.sent;\n              console.log(response.data);\n              setLoading(false);\n              toast.success(response.data);\n              setVideo(INIT_VIDEO);\n              _context2.next = 26;\n              break;\n\n            case 21:\n              _context2.prev = 21;\n              _context2.t0 = _context2[\"catch\"](2);\n              catchErrors(_context2.t0, setError);\n              toast.error(error);\n              console.log(_context2.t0);\n\n            case 26:\n              _context2.prev = 26;\n              setLoading(false);\n              return _context2.finish(26);\n\n            case 29:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 21, 26, 29]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(React.Fragment, {\n    children: [/*#__PURE__*/_jsx(PageBanner, {\n      pageTitle: \"Upload Course Video\",\n      homePageUrl: \"/\",\n      homePageText: \"Home\",\n      activePageText: \"Upload Course Video\"\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"ptb-100\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"container\",\n        children: [courses.length == 0 && /*#__PURE__*/_jsxs(Alert, {\n          color: \"danger\",\n          className: \"text-center\",\n          children: [\"You have to create course first here \", /*#__PURE__*/_jsx(Link, {\n            href: \"/teacher/course/create\",\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: \"Create Course\"\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-md-4 col-lg-4\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"td-sidebar\",\n              children: /*#__PURE__*/_jsxs(\"ul\", {\n                children: [/*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/courses\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"My Courses\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/course/create\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Create A Course\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/courses/course-edit\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Edit My Course\"\n                    })\n                  })\n                }), /*#__PURE__*/_jsx(\"li\", {\n                  children: /*#__PURE__*/_jsx(Link, {\n                    href: \"/teacher/course/upload-course-video\",\n                    activeClassName: \"active\",\n                    children: /*#__PURE__*/_jsx(\"a\", {\n                      children: \"Upload Course Video\"\n                    })\n                  })\n                })]\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-md-8 col-lg-8\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"border-box\",\n              children: /*#__PURE__*/_jsxs(\"form\", {\n                onSubmit: handleSubmit,\n                children: [loading && /*#__PURE__*/_jsx(\"h3\", {\n                  className: \"loading-spinner\",\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \"d-table\",\n                    children: /*#__PURE__*/_jsxs(\"div\", {\n                      className: \"d-table-cell\",\n                      children: [/*#__PURE__*/_jsx(Spinner, {\n                        color: \"danger\"\n                      }), \" Vide uploading...\"]\n                    })\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Select Course\"\n                  }), /*#__PURE__*/_jsxs(\"select\", {\n                    onChange: handleChange,\n                    name: \"courseId\",\n                    className: \"form-control\",\n                    children: [/*#__PURE__*/_jsx(\"option\", {\n                      children: \"Select Course\"\n                    }), courses.map(function (course) {\n                      return /*#__PURE__*/_jsx(\"option\", {\n                        value: course.id,\n                        children: course.title\n                      }, course.id);\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Video Order (1 or 2...)\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"number\",\n                    placeholder: \"Order Number\",\n                    className: \"form-control\",\n                    name: \"order\",\n                    value: video.order,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Name\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"Enter course title\",\n                    className: \"form-control\",\n                    name: \"name\",\n                    value: video.name,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Deescription\"\n                  }), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"text\",\n                    placeholder: \"Enter course title\",\n                    className: \"form-control\",\n                    name: \"description\",\n                    value: video.description,\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"form-group\",\n                  children: [/*#__PURE__*/_jsx(\"label\", {\n                    children: \"Video\"\n                  }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsx(\"input\", {\n                    type: \"file\",\n                    name: \"video_url\",\n                    accept: \"video/*\",\n                    onChange: handleChange\n                  })]\n                }), /*#__PURE__*/_jsx(\"br\", {}), /*#__PURE__*/_jsxs(\"button\", {\n                  className: \"default-btn\",\n                  disabled: disabled || loading,\n                  children: [/*#__PURE__*/_jsx(\"i\", {\n                    className: \"flaticon-right-chevron\"\n                  }), \"Upload\"]\n                })]\n              })\n            })\n          })]\n        })]\n      })\n    })]\n  });\n};\n\nUploadCourseVideo.getInitialProps = /*#__PURE__*/function () {\n  var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(ctx) {\n    var _parseCookies2, token, payload, url, response;\n\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _parseCookies2 = parseCookies(ctx), token = _parseCookies2.token;\n\n            if (token) {\n              _context3.next = 3;\n              break;\n            }\n\n            return _context3.abrupt(\"return\", {\n              courses: []\n            });\n\n          case 3:\n            payload = {\n              headers: {\n                Authorization: token\n              }\n            };\n            url = \"\".concat(baseUrl, \"/api/v1/courses/my-courses\");\n            _context3.next = 7;\n            return axios.get(url, payload);\n\n          case 7:\n            response = _context3.sent;\n            return _context3.abrupt(\"return\", response.data);\n\n          case 9:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function (_x2) {\n    return _ref4.apply(this, arguments);\n  };\n}();\n\nexport default UploadCourseVideo;","map":null,"metadata":{},"sourceType":"module"}